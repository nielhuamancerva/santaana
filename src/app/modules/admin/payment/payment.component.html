<div class="card card-custom gutter-b">
    <div class="card-header">
        <div class="card-title">
            <h3 class="card-label">
            <ng-container>
                Registrar Pago
            </ng-container>
            </h3>
        </div>
        <div class="card-toolbar">
            <a
                type="button"
                class="btn btn-primary"
                routerLink="/admin/payments"
                >Lista de pagos</a>
        </div>
    </div>
    <div class="card-body">
        <ng-container >
           
                <form action="#" class="form form-label-right" [formGroup]="formGroup">
                    <div class="form-group row">
                        <div class="col-lg-4">
                            <div class="form-group">
                                <label>Beneficiario</label>
                              <input type="text" class="form-control form-control-lg form-control-solid" placeholder="Buscar por nombre" aria-label="Buscar" 
                              matInput formControlName="beneficiary" [matAutocomplete]="auto">
                                <mat-autocomplete #auto="matAutocomplete" [displayWith]="displayFn">
                                  <mat-option *ngFor="let _beneficiary of $_filteredBeneficiaries | async" [value]="_beneficiary">
                                    <small class="form-text ">{{ _beneficiary.completeName }}</small>
                                  </mat-option>
                                </mat-autocomplete>
                              </div>    
                        </div>
                        <div class="col-lg-3"></div>
                        <div class="col-lg-5">
                            <div class="form-group">
                                <label>Boleta(s)</label>
                                <div class="example-button-row ">
                                    <mat-form-field class="example-full-width custom-background" appearance="none">
                                        <mat-chip-list #chipList aria-label="" >
                                            
                                            <mat-label *ngFor="let document of $_documentsForPay | async">
                                                <mat-chip  [selectable]="selectable"
                                                            [removable]="( $_documentsForPay | async)?.length > 1" (removed)="remove(document)" >
                                                        {{document.serie}}-{{document.correlative}} S/.{{document.pending | number : '1.2-2'}}
                                                        <mat-icon *ngIf="( $_documentsForPay | async)?.length > 1" matChipRemove>cancel</mat-icon>
                                                    </mat-chip>
                                            </mat-label>
                                            <input  [matChipInputFor]="chipList"
                                            placeholder=""
                                            [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
                                            [matChipInputAddOnBlur]="addOnBlur" 
                                            readonly
                                            formControlName="document_code"
                                            >
                                        </mat-chip-list>
                                        <button class="btn btn-primary" matSuffix mat-icon-button (click)="openDialog()">
                                            <span
                                                [inlineSVG]="'./assets/media/svg/icons/Weather/Cloudy.svg'"
                                                cacheSVG="true"
                                                class="svg-icon menu-icon"
                                                ></span>
                                        </button>
                                        
                                    </mat-form-field>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="form-group row">
                        <div class="col-lg-4">
                            <label>Nota</label>
                            <input 
                                type="textarea" 
                                class="form-control form-control-lg form-control-solid"
                                placeholder="Ingrese una nota" 
                                name="note"
                                formControlName="note"
                            />
                        </div>
                        <div class="col-lg-4"></div>
                        <div class="col-lg-4">
                            <label>Total a Pagar <b>Soles</b></label>
                            <input 
                                type="number" 
                                class="form-control form-control-lg form-control-solid"
                                placeholder="Importe a Total" 
                                formControlName="totalPaid"
                                readonly
                            />
                        </div>
                    </div>

                    <div class="form-group row">
                        <div class="col-lg-4">
                            <button class="btn btn-primary" (click)="uploadFile()" type="button">
                                Cargar Imagen
                                <span
                                [inlineSVG]="'./assets/media/svg/icons/Files/Uploaded-file.svg'"
                                cacheSVG="true"
                                class="svg-icon menu-icon"
                              >
                            
                            </span>
                            </button>
                            <div>
                                <input id="fileUploader" style="display: none;" type="file" accept=".png, .jpg, .jpeg" (change)="onFileChange($event)" />
                            </div>
                        </div>
                        <div class="col-lg-4"></div>
                        <div class="col-lg-4">
                            <label>Monto Recibido <b>Soles</b></label>
                            <input 
                                type="number" 
                                class="form-control form-control-lg form-control-solid"
                                placeholder="Monto recibido" 
                                [class.is-invalid]="isControlInvalid('received')"
                                [class.is-valid]="isControlValid('received')"
                                formControlName="received"
                            />
                            <div
                                class="invalid-feedback"
                                *ngIf="controlHasError('required', 'received')">
                                    Monto recibido es requerido
                            </div>
                        </div>  
                    </div>


                    <div class="form-group row">
                        <div class="col-lg-8">
                            <div class="form-group row">
                                <div class="col-lg-3" *ngFor='let item of $_urls | async' [id]="item.url">
                                    <div *ngIf="item.show">
                                        <div class="image-input image-input-outline" id="kt_profile_avatar">
                                            <img class="image-input-wrapper" [src]="item.url">
                                            <span [id]="item.url"
                                                class="btn btn-xs btn-icon btn-circle btn-white btn-hover-text-primary btn-shadow"
                                                (click)="eliminar($event)"
                                                *ngIf="item.delete"
                                                data-action="remove" title="" data-original-title="Remove avatar">
                                                <i class="ki ki-bold-close icon-xs text-muted"></i>
                                            </span>
        
                                            <span class="btn btn-xs btn-icon btn-circle btn-white btn-hover-text-primary btn-shadow"
                                                data-action="cancel" data-toggle="tooltip" title="" data-original-title="Cancel avatar">
                                                <i class="ki ki-bold-close icon-xs text-muted"></i>
                                            </span>
        
                                        </div>
                                        
                                    </div>
                                </div>
                        </div>
                        </div>
                        <div class="col-lg-4">
                            <label>Monto a pagar <b>Soles</b></label>
                            <input 
                                type="number" 
                                class="form-control form-control-lg form-control-solid"
                                placeholder="Monto recibido" 
                                [class.is-invalid]="isControlInvalid('toPaid')"
                                [class.is-valid]="isControlValid('toPaid')"
                                formControlName="toPaid"
                            />
                            <span class="form-text">Vuelto: S/ {{returned | number : '1.2-2' }}</span>
                            <div
                                class="invalid-feedback"
                                *ngIf="controlHasError('required', 'toPaid')">
                                Monto a pagar es requerido
                            </div>
                            <div
                                class="invalid-feedback"
                                *ngIf="controlHasError('min', 'toPaid')">
                                Monto ingresado no puede menos a 8 soles
                            </div>
                        </div>  
                    </div>
                    
                    
                        

                    <div class="float-right">
                    <button
                        type="submit"
                        class="btn btn-primary font-weight-bold mr-2"
                        (click)="save()"
                        [disabled]="formGroup.invalid || !($_documentsForPay.getValue().length > 0)"
                    >
                        Registrar
                    </button>
                    </div>
                </form>
            
        </ng-container>
    </div>
</div>